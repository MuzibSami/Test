import hvac

def get_all_vault_secrets(vault_url, vault_token, secrets_engine):
    client = hvac.Client(url=vault_url, token=vault_token)

    try:
        secrets_list = client.secrets.kv.v2.list_secrets(path=secrets_engine, list=True)["data"]["keys"]
        secrets = {}
        for secret_key in secrets_list:
            secret_path = f"{secrets_engine}/{secret_key}"
            secret = client.secrets.kv.v2.read_secret_version(path=secret_path)
            if "data" in secret["data"]:
                secrets[secret_key] = secret["data"]["data"]
            else:
                subsecrets = get_all_vault_secrets(vault_url, vault_token, secret_path)
                secrets[secret_key] = subsecrets
        return secrets
    except Exception as e:
        raise ValueError(f"Unable to retrieve secrets from Vault: {str(e)}")

vault_url = "http://localhost:8200"
vault_token = "<your_token_here>"
secrets_engine = "TASK"

secrets = get_all_vault_secrets(vault_url, vault_token, secrets_engine)
print(secrets)



import hvac

def get_all_vault_secrets(vault_url, token, secrets_engine):
    client = hvac.Client(url=vault_url, token=token)
    secrets_list = []
    try:
        secret_metadata = client.secrets.kv.v2.list_secrets(path=secrets_engine)
        for secret_path in secret_metadata["data"]["keys"]:
            secret = client.secrets.kv.v2.read_secret_version(path=f"{secrets_engine}/{secret_path}")["data"]["data"]
            secrets_list.append(secret)
    except Exception as e:
        raise ValueError(f"Unable to retrieve secrets from Vault: {str(e)}")
    return secrets_list
